$Id: TODO,v 1.81 2007-01-11 12:00:04 joostvb Exp $

--- typesetting stuff ---

- get toc printed in html mode. even while using nochunks mode.

- license should be printed, see rh vs deb doc.

- add zoem.mk, for zoem ( http://micans.org/zoem ) typesetting.

--- install stuff ---

- Suggest (or offer) a more generic interface than my_EXEC for the load
  target.  Users are invited to extend the interface.
  They can add extra variables to their push mechanisms.  So we might be
  able to abstract LOAD one day.  Perhaps something like

    $(foreach uh,$(csp_UHOSTS),$(call csp_EXEC,$(uh),$(csp_DIR),$(csp_XARG));)

  could work.  If a user's exec wrapper needs more arguments, these can get
  introduced as implicit variables, outside $1, $2, ...

- Get rid of csp_SUHDIRS and other obsolete variable.  Get rid or SCP and CP
  RULEs in caspar.mk.

- Add a real-life complete example to manpage: multiple directories, multiple
  hosts, groups of hosts.  Explain why it's good practice to do
    include ../../include/install.mk
  .

- Supply a preset loop over hosts, for load target.

- Don't do
   csp_scp_FUNC  = $(csp_SCP) $(csp_CPFLAGS) $(1) $(2):$(3)
  but do
   csp_scp_FUNC  = $(csp_SCP) $(4) $(1) $(2):$(3)
  and use $(csp_CPFLAGS) for csp_XARGS.
  _Do_ test this!

- this whole thing could probably better use rsync, or, alternatively, perhaps
  caspar is redundant: there is cfengine.  Perhaps people would be better of
  with a get-started-quick cfengine document. See caspar(7).

- add support for install(1).

- The function $(subst -install,,$@) in caspar.mk breaks when filename itself
  has the substring -install.  We might have to use sed here, and strip only
  a _trailing_ '-install' from the maketarget.

- load stuff:
  - Create a ``load-recursive'' target.
  - supply daemons.mk: csp_SSHDEBIANLOAD csp_URUKREDHATLOAD , etc, to use
    in load targets

- document this:

 dirs = $(patsubst %/Makefile,%,$(shell find * -mindepth 1 -name Makefile))

 all:
   for i in $(dirs);do make -C $$i;done

 install
   for i in $(dirs);do make -C $$i install; done

 load
   for i in $(dirs);do make -C $$i load; done

 
 This allows a toplevel makefile; _without_ the need to install makefiles in
 all non-leaf directories too.  Thanks Wessel.


- document this: we have a csp_BUILD too.  If you want to do some syntax check
  on remote host too (and have a "make check" thing), do

    csp_LOAD = check my-load

    my-load:
      ssh $(csp_scp_UHOST) do load stuff

    check:
      ssh $(csp_scp_UHOST) do check stuff

  Test wether "make load" won't load if "check" fails (it should).
  Document how to use csp_BUILD.

- install-recursive should call mkdir if appropriate.  install should, too.

 Thu 31 15:16 < Fruit> kan ik 'm ook vertellen dat-ie voordat gaat kopiÃ«ren ff 
                       mkdir -p op de smurfer doet?
 Thu 31 15:19 < joostvb> een eigen csp_PUSH schrijven
 Thu 31 15:20 < joostvb> csp_PUSH krijgt zowel filenaam als directory mee als 
                         argument
 Thu 31 15:20 < joostvb> dus das kei makkelijk
 Thu 31 15:20 < Fruit> csp_OLD_PUSH := $(csp_PUSH)
 Thu 31 15:20 < Fruit> csp_PUSH := ssh $iets mkdir $dir; $(csp_OLD_PUSH)

- The scp invocation is inefficient:

   % make -n README.txt-install net.txt-install
   scp "README.txt" pong:/data/www/doc/doc/;
   scp "net.txt" pong:/data/www/doc/doc/;

  Should be:

   scp "README.txt" "net.txt" pong:/data/www/doc/doc/;

  $@ vs $? might be helpful.

- Implement csp_UHOSTS_SUBSET: only deal with this subset of csp_UHOSTS.  Just
  process the intersection (doorsnede) of csp_UHOSTS_SUBSET and csp_UHOSTS.
  Requested by Wessel Dankers (and the author).  It'll work nice in cases
  where you have lots of subdirectories holding information for lots of groups
  of hosts when you want to install just for a small group (or 1) hosts.

  It also protects one from no longer current overrides of csp_UHOSTS in the
  environment: one now can use csp_UHOSTS_SUBSET for temporal overrides.

  Test this, and document this.

- test wether file is up to date before scp-ing it.  use rsync?  use
  ControlMaster ssh_config(5) to reuse one ssh conection?  Perhaps this:

   ControlMaster auto
   ControlPath ~/.ssh/control/%r@%h:%p

  in your ~/.ssh/config fixes all "troubles". (This option is not available
  on Debian sarge.)

