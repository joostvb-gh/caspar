#!/bin/sh

# $Id: csp_sucp,v 1.3 2006-02-15 18:30:18 joostvb Exp $
# $Source: /cvsroot/caspar/caspar/caspar/script/csp_sucp,v $

# csp_sucp - mix scp with sudo
#
# example usage:
#  csp_sucp fstab rms@bilbo /etc
#  csp_sucp trailer.txt monty-python commit/trailer.txt list

# command line argument overrules environment variable
test -n "$CSP_SUCP_USER" && opt_u="$CSP_SUCP_USER"
test -n "$4" && opt_u="-u $4"

# first make sure our sudo-timestamp is fresh
ssh -T $2 sudo -v $opt_u
# now run sudo: we won't be prompted for a password; and
# can use stdin for our data
exec ssh $2 "sudo $opt_u sh -c \"cat - > $3/$1\"" < $1

